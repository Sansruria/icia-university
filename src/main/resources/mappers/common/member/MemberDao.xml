<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="kr.ac.icia.dao.common.member.MemberDao">

    <select id="findPwById" parameterType="kr.ac.icia.dto.common.member.MemberDto" resultType="String">
        SELECT password FROM ${tableName} WHERE ${columnName} = #{userId}
    </select>

    <select id="findId" parameterType="kr.ac.icia.dto.common.member.MemberDto" resultType="String">
        SELECT
            userId,
            name,
            rrn
        FROM (
            SELECT st_id AS userId, st_name AS name, rrn FROM st
            UNION
            SELECT pf_id, pf_name, rrn FROM pf)
        WHERE rrn = #{rrn} AND name = #{name}
    </select>

    <select id="findPw" parameterType="kr.ac.icia.dto.common.member.MemberDto">
        SELECT COUNT(*) FROM ${tableName}
                        WHERE rrn = #{rrn}
                              AND
                              <if test="tableName == 'st'">
                                  st_id = #{userId}
                              </if>

                              <if test="tableName == 'pf'">
                                  pf_id = #{userId}
                              </if>
    </select>

    <select id="findStInfoById" parameterType="String" resultType="kr.ac.icia.dto.common.member.MemberDto">
        SELECT
            st.st_id as userId,
            st.department_id AS deptId,
            d.department_name AS deptName,
            st.rrn,
            st.st_name AS name,
            st.gender,
            st.address,
            st.email,
            st.profile,
            st.national,
            NVL(r.register_change_id, '재학') AS status
        FROM st
        JOIN department d ON st.department_id = d.department_id
        LEFT OUTER JOIN register r ON st.st_id = r.st_id
        WHERE st.st_id = #{userId}
    </select>

    <select id="findPfInfoById" parameterType="String" resultType="kr.ac.icia.dto.common.member.MemberDto">
        SELECT
            pf.pf_id AS userId,
            pf.department_id AS deptId,
            d.department_name AS deptName,
            pf.rrn,
            pf.pf_name AS name,
            pf.gender,
            pf.address,
            pf.email,
            pf.national
        FROM pf
        JOIN department d ON d.department_id = pf.department_id
        WHERE pf.pf_id = #{userId}
    </select>

    <update id="resetPw" parameterType="kr.ac.icia.dto.common.member.MemberDto">
        UPDATE ${tableName} SET password = #{password} WHERE ${columnName} = #{userId}
    </update>

</mapper>